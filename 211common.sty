\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{211common}[2020/04/11 0.0.1]

\newcommand\TERM{Winter 2020}
\newcommand\COURSENO{CS 211}
\newcommand\WEBROOT{https://users.cs.northwestern.edu/~jesse/course/cs211}

\newcommand\LabHostnames@Url
  {it.eecs.northwestern.edu/info/2015/11/03/info-labs.html\#workstations}
\newcommand\LabHostnames@ShortUrl
  {https://bit.ly/3c1qyui}
\newcommand\LabHostnamesLink
  {\href{\LabHostnames@ShortUrl}{{\UrlFont{\LabHostnames@Url}}}}
% Probably update this next year:
\newcommand\Cxx@setup@local{\WEBROOT/notes/toolchain_setup.html}
\newcommand\Cxx@setup@linux{\WEBROOT/notes/ge211_linux.html}

\newif\if@cxx\@cxxfalse
\DeclareOption{cxx}{\@cxxtrue}
\ProcessOptions\relax

\RequirePackage{fancyvrb}
\RequirePackage{microtype}
\RequirePackage{url}
\RequirePackage{underscore}
\RequirePackage[final]{listings}
\RequirePackage{amsmath}
\RequirePackage[dvipsnames]{xcolor}
\RequirePackage{hyperref}

\newcommand\@pad@two[1]{\@pad@two@check#1\\}
\newcommand\@pad@two@check[2]{%
  \ifx#2\\0\fi
  #1%
}

\urlstyle{sf}

\newcommand\ZII@shade{85}
\colorlet{ZII@linkcolor}{violet}
\colorlet{ZII@citecolor}{YellowOrange}
\colorlet{ZII@urlcolor}{NavyBlue}

\hypersetup{
  linkcolor  = ZII@linkcolor!\ZII@shade!black,
  citecolor  = ZII@citecolor!\ZII@shade!black,
  urlcolor   = ZII@urlcolor!\ZII@shade!black,
  colorlinks = true,
}

\newcommand\progname[1]{\emph{#1}}
\newcommand\hostname[1]{\emph{#1}}
\newcommand\filename[1]{\textsf{#1}}
\newcommand\varname[1]{\textsf{#1}}
\newcommand\functionname[1]{\textsl{#1}}
\newcommand\functionref[2]{\functionname{#1}(#2)}
\newcommand\promptchar{\%}
\newcommand\prompt{{\normalfont\ttfamily\itshape\promptchar}}
\newcommand\cmdline[1]{\prompt{\normalfont\ttfamily\bfseries~#1}}
\newcommand\keycombo[1]{\textsf{#1}}

\newcommand\codeBasicstyle{\ttfamily}
\newcommand\codeCommentstyle{\codeBasicstyle\color{gray}}
\newcommand\codeKeywordstyle{\codeBasicstyle\bfseries}
\newcommand\codeSpecialstyle{\codeKeywordstyle\color{red!30!black!80!white}}

\colorlet{metavar@color}{DarkMagenta}
\newcommand\metavar[1]{%
  \textcolor{metavar@color}{%
    \ensuremath\langle
    {\normalfont\itshape#1}%
    \ensuremath\rangle%
  }%
}

\lstset{%
  upquote=true,
  basicstyle=\codeBasicstyle,
  commentstyle=\codeCommentstyle,
  keywordstyle=\codeKeywordstyle,
  keywordstyle=[2]\codeKeywordstyle,
  keywordstyle=[3]\codeSpecialstyle,
  escapeinside={‹}{›},
}

\lstdefinelanguage[211]{C}[ANSI]{C}%
  {%
    morekeywords={%
      assert,%
      size_t,%
    },
    % lib211 definitions
    morekeywords=[2]{%
      CHECK,%
      CHECK_CHAR,%
      CHECK_INT,CHECK_UINT,%
      CHECK_LONG,CHECK_ULONG,CHECK_SIZE,%
      CHECK_DOUBLE,%
      CHECK_STRING,%
      CHECK_POINTER,%
    },
    % weird shit
    morekeywords=[3]{%
      NULL,%
    },
  }

\lstdefinelanguage[211]{C++}[11]{C++}%
  {%
    morekeywords={%
      size_t,%
      CHECK,%
      TEST_CASE%
    },
  }

\newcommand\set@current@lang[1]{%
  \if@cxx
    \lstset{language=[211]C++,#1}%
  \else
    \lstset{language=[211]C,#1}%
  \fi
}

\lstnewenvironment{Code}[1][]
{%
  \begingroup
  \set@current@lang{#1}
}
{%
  \endgroup
}

\newsavebox{\CodeHeading@savebox}

\lstnewenvironment{CodeHeading}[2][]
{%
  \addcontentsline{toc}{subsubsection}{-- #2}%
  \set@current@lang{%
    aboveskip=2pt plus 0pt,
    belowskip=2pt plus 0pt,
    linewidth=0.95\linewidth,
    #1
  }%
  \global\setbox\CodeHeading@savebox\vbox\bgroup
}
{%
  \egroup
  \vspace{.5ex plus 0.1ex}
  \begin{trivlist}
    \item\framebox[\linewidth]{\usebox{\CodeHeading@savebox}}
  \end{trivlist}
  \vspace{.25ex plus 0.05ex}
}

\newcommand{\textCode}{%
  \set@current@lang{}%
  \lstinline
}

\let\sup^
\catcode`^\active
\def^{\@ifnextchar^\nb@textCode\br@textCode}
\def\nb@textCode^#1^^{\textCode{#1}}
\def\br@textCode#1^{{%
  \lstset{
    breaklines=true,
    breakatwhitespace=true,
  }%
  \textCode{#1}%
}}

\newenvironment{CmdLine}[1][3em]
  {%
    \ttfamily
    \def\O##1\\{\item{##1}}%
    \def\C##1\\{\O\prompt~\textbf{##1}\\}%
    \def\I##1\\{\O\textbf{##1}\\}%
    \def\E##1\\{\O\underline{##1}\\}%
    \def\ETC{\O\ensuremath{\vdots}\\}%
    \def\finish@CmdLine{\O\prompt\\}%
    \def\NoPrompt{\let\finish@CmdLine\relax}%
    \begin{list}{}{
      \leftmargin=#1%
      \parsep=0pt%
      \itemsep=-1pt%
    }
  }
  {%
    \finish@CmdLine
    \end{list}%
  }

\newenvironment{CmdLine*}[1][3em]
  {\begin{CmdLine}}
  {\NoPrompt\end{CmdLine}}
