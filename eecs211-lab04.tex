\RequirePackage{fixltx2e}
\documentclass{tufte-handout}

\usepackage{eecs211-lab}

\title{EECS 211 Lab 4}
\author{Shared Pointers and References}
\date{Winter 2017}

\begin{document}

\maketitle

Today we will be getting comfortable with shared pointers and references. We'll review what they are, how to use them, and what they are useful for.  This can be a very tricky subject, so don't get discouraged if it is a bit difficult at first.

\section{Getting the code}
Download the zip file from the course site: \medskip

\url{http://users.eecs.northwestern.edu/~jesse/course/eecs211/lab/eecs211-lab04.zip}

\medskip \noindent
After you have downloaded the zip file onto your laptop, extract the zip file into its own folder. Make sure you keep track of which folder it's in!  Next, open up CLion and Click on File --> Open Project, and click on the Lab 4 project that you just unzipped. 

Once you open the project, try building the lab and then running the lab4 executable. 
You should see a friendly message printed in your output subwindow.
If you need a reminder on how to build and run code in CLion, consult lab 3 or ask your TA.
Once this works, you're ready to start the lab!


\section{Shared Pointers}
A pointer is a variable. 
It's similar to other variables that we've learned about so far, however, there's one big distinction. 
A pointer itself doesn't actually contain the data that you tend to use in your functions.  
Instead, a pointer's data is actually just where it \textit{points} to in memory.
But, at the place where that pointer points in memory, there can be the typical data that we are used to seeing.  
You need to tell C++ in advance what data type will be stored where the pointer points to, using the following syntax:

\begin{Code}
shared_ptr<DATA_TYPE> ptr_name;
\end{Code}

\noindent
However, this is just creating a null pointer\marginnote{We'll get into these more in a bit.}, without actually creating an address in memory for our pointer.
If we want to create a spot in memory for our pointer, we use the following syntax:

\begin{Code}
shared_ptr<DATA_TYPE> ptr_name = make_shared<DATA_TYPE>();
\end{Code}

\noindent
If you can look in your \filename{lab4.cpp}, you can see we created a shared\_ptr  called \varname{crazy\_ptr} using the following syntax:

\begin{Code}
shared_ptr<Circus> crazyPtr = make_shared<Circus>();
*crazyPtr = crazyCircus;
\end{Code}

\noindent
The first line of this code declares our shared\_ptr to point to a Circus in memory. 
The next line tells the place in memory that \varname{crazy\_ptr}  points to to hold a Circus that we previously defined called \varname{crazy\_circus}.  
This is done through \textit{dereferencing} \varname{crazy\_ptr}, a.k.a. putting an asterisk before the shared\_ptr.  
This gives us the value at the place in memory our shared\_ptr points to.

\subsection{Null Pointers}

If we are creating a \varname{shared\_ptr} by just declaring it without defining it with \varname{make\_shared}, we get what is called a null pointer, which is represented in C++ by \varname{nullptr}.
When creating libraries and API's, it is very\marginnote{Really important.} important to consider the case where your function receives a \varname{nullptr} as input, as a \varname{nullptr} can't be de-referenced.

\subsection{Why Use Shared Pointers?}
When you start a C++ program, you get allocated a certain amount of memory for your program to store local variables, where you are in your program, and your program itself in a place called the \textit{Stack}.
\marginnote{The size of your stack varies depending on your operating system, your compiler version, and a few other factors, but generally nowadays it'll be around 1 MB}
This stack is limited in memory, so when you start getting bigger data structures you want to define, you will realize quickly how easy it is to run out of space on your stack creating what is called a \textit{Stack Overflow}.
Now, to avoid this, you can define a small pointer on your stack, which points to a place in memory in the free store, a big pool of memory on your computer that is not already allocated to your program.
Defining a shared\_ptr itself on your stack does not take up much memory, but the object it points to may take up a lot of memory.  
This is why it is important to have that object be in free store, and just access that data through our pointers.

For example, in the \filename{lab4.cpp}, you can see that \varname{crazy\_ptr}, our pointer to the \varname{crazy\_circus}, only took up 16 bytes of memory, but the \varname{crazy\_circus} itself took up 160 bytes of memory. 

\section{References}
If you remember from last week's lab and class, passing a variable by reference allows the variable that you pass into a function that accepts an argument by reference to be changed when that argument changes.
This is denoted by an ampersand before the argument name in the function definitions and declarations.
This is probably still a bit confusing, so go to circus.cpp and check out the two functions \functionname{passed\_by\_copy} and \functionname{passed\_by\_reference}.  
While these functions are identical on the outside, notice how they can affect the variables passed into the functions from \functionname{int main()}. 
In \filename{lab4.cpp} we print out \varname{name} and \varname{owner} after each function call and notice how after the \functionname{passed\_by\_copy} function call, \varname{name} and \varname{owner} are still the same as before the function call.
Also notice how after the \functionname{passed\_by\_reference} function call, the variables values were changed by that function.

\section{Practicing with Shared Pointers and References}
Now that we've reviewed how and why to use shared pointers and references, let's get some practice. Open up \filename{circus.cpp} in CLion. 
There's several function skeletons waiting to be implemented. 
Give them a try and see if you can get them working - if things aren't making sense, don't hesitate to ask your TA!
We've included a set of test cases in circus\_test.cpp, which you can run after you build your code. 

\end{document}
